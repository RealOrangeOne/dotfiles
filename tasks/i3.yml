- name: "Install i3 packages"
  aur:
    skip_installed: true
    name: "{{ item }}"
  become: true
  become_user: aur_builder
  when: "item not in installed_packages.stdout_lines"
  with_items:
    - 'betterlockscreen'
    - 'brightnessctl'
    - 'compton'
    - 'dmenu'
    - 'dunst'
    - 'feh'
    - 'flameshot'
    - 'i3-gaps'
    - 'i3lock-color-git'
    - 'lxqt-policykit'
    - 'numix-gtk-theme'
    - 'aur/polybar'
    - 'qt5-styleplugins'
    - 'rofi'
    - 'tbg'


- set_fact:
    polybar_scripts: "{{ home }}/.config/polybar/polybar-scripts/polybar-scripts"
    i3_config_files:
      - {src: "i3.conf", dest: "{{ home }}/.config/i3/config"}
      - {src: "i3status.conf", dest: "{{ home }}/.config/i3status/config"}
      - {src: "compton.conf", dest: "{{ home }}/.config/compton.conf"}
      - {src: "dunst.conf", dest: "{{ home }}/.config/dunst/dunstrc"}
      - {src: "polybar.ini", dest: "{{ home }}/.config/polybar/config"}

- name: "Create i3 config file directories"
  with_items: "{{ i3_config_files }}"
  file:
    path: '{{ item.dest | dirname }}'
    state: directory
    owner: "{{ user }}"
    mode: 0755

- name: "i3 config files"
  with_items: "{{ i3_config_files }}"
  template:
    src: './files/{{ item.src }}'
    dest: '{{ item.dest }}'
    mode: 0644
    owner: "{{ user }}"


- name: "Create polybar config directory"
  file:
    path: '{{ home }}/.config/polybar/'
    state: directory
    owner: "{{ user }}"
    mode: 0755


- name: "Polybar scripts"
  git:
    repo: https://github.com/x70b1/polybar-scripts
    dest: "{{ home }}/.config/polybar/polybar-scripts"
    force: true
  become: true
  become_user: "{{ user }}"

- copy:
    src: ./files/launch-polybar.sh
    dest: "{{ home }}/.config/polybar/launch.sh"
    mode: 0755
    owner: "{{ user }}"
    group: users


- name: "Create rofi config directory"
  file:
    path: '{{ home }}/.config/rofi/'
    state: directory
    owner: "{{ user }}"
    mode: 0755

- name: "Create rofi config"
  copy:
    src: './files/rofi.conf'
    dest: '{{ home }}/.config/rofi/config'
    mode: 0644
    owner: "{{ user }}"
